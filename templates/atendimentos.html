{% extends "base.html" %}

{% block title %}Atendimentos{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Todos os Atendimentos</h1>

    <!-- Botão para abrir modal -->
    <button type="button" class="btn btn-primary mb-3" data-coreui-toggle="modal" data-coreui-target="#cadastroAtendimentoModal">
        Cadastrar Atendimento
    </button>

    <!-- Tabela de atendimentos -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Data</th>
                <th>Funcionário</th>
                <th>Alunos</th>
                <th>Jogos</th>
                <th>Progresso</th>
            </tr>
        </thead>
        <tbody>
            {% for atendimento in atendimentos %}
            <tr>
                <td>{{ atendimento.data_atendimento.strftime('%d/%m/%Y') }}</td>
                <td>{{ atendimento.funcionario.nome }}</td>
                <td>
                    {% for aluno in atendimento.alunos %}
                        {{ aluno.nome }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% for jogo in atendimento.jogos %}
                        {{ jogo.nome }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>{{ atendimento.progresso_aluno or "N/A" }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">Nenhum atendimento cadastrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal de cadastro -->
<div class="modal fade" id="cadastroAtendimentoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="{{ url_for('atendimento.cadastrar_atendimento') }}" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Cadastrar Novo Atendimento</h5>
          <button type="button" class="btn-close" data-coreui-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <!-- Multi-select Alunos -->
          <div class="mb-3">
            <label for="alunos" class="form-label">Alunos</label>
            <select name="alunos" id="alunos" class="form-multi-select" multiple data-coreui-search="global" required>
              {% for aluno in alunos %}
                <option value="{{ aluno.id_aluno }}">{{ aluno.nome }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Multi-select Jogos -->
          <div class="mb-3">
            <label for="jogos" class="form-label">Jogos</label>
            <select name="jogos" id="jogos" class="form-multi-select" multiple data-coreui-search="global" required>
              {% for jogo in jogos %}
                <option value="{{ jogo.id_jogo }}">{{ jogo.nome }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label for="progresso" class="form-label">Progresso do Aluno</label>
            <textarea name="progresso" id="progresso" class="form-control" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-coreui-dismiss="modal">Fechar</button>
          <button type="submit" class="btn btn-primary">Cadastrar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- CoreUI JS -->
<script src="https://cdn.jsdelivr.net/npm/@coreui/coreui-pro@5.19.0/dist/js/coreui.bundle.min.js"></script>
{% endblock %}
